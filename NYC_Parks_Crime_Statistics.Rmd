---
title: 'NYC Parks Crime Statistics: An Exploratory  Analysis'
author: "Madison Volpe"
date: "6/10/2018"
output: pdf_document
---

####Cleaning and Combining Data 

```{r}
setwd("/Users/madisonvolpe/Desktop/ParkCrimes")
#libraries
library(dplyr)
library(openxlsx)
library(ggplot2)
library(ggmap)
library(lemon)
library(knitr)
library(xtable)
library(tidyr)
#reading in data 

#2015
Qone15 <- read.xlsx("Q12015.xlsx", sheet = 1, startRow = 5, colNames = TRUE)
Qone15$Quarter <- rep("Q1", nrow(Qone15))
Qone15$Year <- rep(2015, nrow(Qone15))

Qtwo15 <- read.xlsx("Q22015.xlsx", sheet = 1, startRow = 5, colNames = TRUE)
Qtwo15$Quarter <- rep("Q2", nrow(Qtwo15))
Qtwo15$Year <- rep(2015, nrow(Qtwo15))

Qthr15 <- read.xlsx("Q32015.xlsx", sheet = 1, startRow = 5, colNames = TRUE)
Qthr15$Quarter <- rep("Q3", nrow(Qthr15))
Qthr15$Year <- rep(2015, nrow(Qthr15))


Qfour15 <- read.xlsx("Q42015.xlsx", sheet = 1, startRow = 4, colNames = TRUE)
Qfour15$Quarter <- rep("Q4", nrow(Qfour15))
Qfour15$Year <- rep(2015, nrow(Qfour15))


#2016 
Qone16 <- read.xlsx("Q12016.xlsx", sheet =1, startRow = 4, colNames = TRUE)
Qone16$Quarter <- rep("Q1", nrow(Qone16))
Qone16$Year <- rep(2016, nrow(Qone16))

Qtwo16 <-read.xlsx("Q22016.xlsx", sheet =1, startRow = 4, colNames = TRUE)
Qtwo16$Quarter <- rep("Q2", nrow(Qone16))
Qtwo16$Year <- rep(2016, nrow(Qtwo16))

Qthr16 <- read.xlsx("Q32016.xlsx", sheet =1, startRow = 4, colNames = TRUE)
Qthr16$Quarter <- rep("Q3", nrow(Qthr16))
Qthr16$Year <- rep(2016, nrow(Qthr16))

Qfour16 <- read.xlsx("Q42016.xlsx", sheet =1, startRow = 4, colNames = TRUE)
Qfour16$Quarter <- rep("Q4", nrow(Qfour16))
Qfour16$Year <- rep(2016, nrow(Qfour16))

#2017 

Qone17 <- read.xlsx("Q12017.xlsx", sheet =1, startRow = 4, colNames = TRUE)
Qone17$Quarter <- rep("Q1",nrow(Qone17))
Qone17$Year <- rep(2017, nrow(Qone17))

Qtwo17 <-read.xlsx("Q22017.xlsx", sheet =1, startRow = 4, colNames = TRUE)
Qtwo17$Quarter <- rep("Q2", nrow(Qtwo17))
Qtwo17$Year <- rep(2017, nrow(Qtwo17))

Qthr17 <- read.xlsx("Q32017.xlsx", sheet =1, startRow = 4, colNames = TRUE)
Qthr17$Quarter <- rep("Q3", nrow(Qthr17))
Qthr17$Year <- rep(2017, nrow(Qthr17))

Qfour17 <- read.xlsx("Q42017.xlsx", sheet =1, startRow = 4, colNames = TRUE)
Qfour17$Quarter <- rep("Q4", nrow(Qfour17))
Qfour17$Year <- rep(2017, nrow(Qfour17))

```

####Merging twelve datasets into one

```{r}
#give generic column names 
varNames <- names(Qone15)

#create function to change column names of all tweleve dataframes 
ChgNames<-function(dat){
  names(dat) <- varNames
  return(dat)
}

#assign dfs to list 
dfs <- list(Qone15,Qtwo15,Qthr15,Qfour15, Qone16, Qtwo16, Qthr16, Qfour16, Qone17, Qtwo17, Qthr17, Qfour17)

#lapply ChgNames function to dfs 
dfs <- lapply(dfs, ChgNames)

#unlist dfs  and merge as one dataframe 
Crime<- as.data.frame(do.call(rbind, dfs))

#view structure of crime 
str(Crime)

#making certain columns numeric
num.cols <- c("SIZE.(ACRES)", "MURDER", "RAPE", "ROBBERY", "FELONY.ASSAULT", "BURGLARY", "GRAND.LARCENY", "GRAND.LARCENY.OF.MOTOR.VEHICLE", "TOTAL")
Crime[num.cols] <- sapply(Crime[num.cols],as.numeric)

#checking structure
str(Crime)

#remove NAs from dataset 
for(i in 1:nrow(Crime)){
  if(is.na(Crime$BOROUGH[i])==TRUE){
    Crime <- Crime[-i,]
  }
}

#check to see if NAs are gone
anyNA(Crime)
```

####Exploratory Analysis and Charts 

##Total Crimes by Year and Crime Type
```{r dplyr, kable.opts=list(caption="Crimes by Year")}
TotCrimesYear <- Crime %>%
  group_by(Year) %>%
  summarise(GrandTotal = sum(TOTAL), MurderTotal = sum(MURDER), RapeTotal = sum(RAPE), FelonyTotal = sum(FELONY.ASSAULT), LarcenyTotal = sum(GRAND.LARCENY), RobberyTotal = sum(ROBBERY), LarcenyVehicleTotal = sum(GRAND.LARCENY.OF.MOTOR.VEHICLE), BurglaryTotal = sum(BURGLARY))
```

\begin{table}[ht]
\caption{Total Crimes by Year in NYC Parks}
\centering
\begin{tabular}{lp{.5in}p{.5in}p{.5in}p{.5in}p{.5in}p{.5in}p{.5in}p{.5in}p{.5in}}
  \hline
 & Year & Total & Murder & Rape & Felony & Larceny & Robbery & Vehicle & Burglary \\ 
  \hline
1 & 2015 & 951 & 9 & 20 & 198 & 367 & 330 & 7 & 20 \\ 
  2 & 2016 & 1198 & 9 & 21 & 206 & 526 & 409 & 4 & 23 \\ 
  3 & 2017 & 1259 & 2 & 26 & 234 & 542 & 427 & 7 & 21 \\  
   \hline
\end{tabular}
\end{table}

#Grouped Barchart
```{r}
#from wide to long--easier to make ggplot 
TotCrimesYearLong <- gather(TotCrimesYear, Crime_Type, Amount, GrandTotal:BurglaryTotal)

#Grouped 
ggplot(TotCrimesYearLong, aes(fill=Crime_Type, y=Amount, x = Year))+
  geom_bar(position = "dodge", stat = "identity")+
  geom_text(aes(label = Amount), position = position_dodge(.9), vjust = 0)+
  ggtitle("Total Crimes by Year and Crime Type in NYC Parks") + 
  labs(y = "Number of Crimes")
```

#Grouped Barchart without Total

```{r}
#subset to remove GrandTotal 
TotCrimesYearLongb <- TotCrimesYearLong[which(TotCrimesYearLong$Crime_Type != "GrandTotal"),]
ggplot(TotCrimesYearLongb, aes(fill=Crime_Type, y=Amount, x = Year))+
  geom_bar(position = "dodge", stat = "identity")+
  geom_text(aes(label = Amount), position = position_dodge(.9), vjust = 0)+
  ggtitle("Total Crimes by Year and Crime Type in NYC Parks") + 
  labs(y = "Number of Crimes")
```

##Total Crimes by Borough 

```{r}
TotCrimesBorough <- Crime %>%
  group_by(BOROUGH) %>%
  summarise(GrandTotal = sum(TOTAL), MurderTotal = sum(MURDER), RapeTotal = sum(RAPE), FelonyTotal = sum(FELONY.ASSAULT), LarcenyTotal = sum(GRAND.LARCENY), RobberyTotal = sum(ROBBERY), LarcenyVehicleTotal = sum(GRAND.LARCENY.OF.MOTOR.VEHICLE), BurglaryTotal = sum(BURGLARY))

print(xtable(TotCrimesBorough))
```

\begin{table}[ht]
\caption{Total Crimes by Borough in NYC Parks}
\centering
\begin{tabular}{lp{.6in}p{.6in}p{.6in}p{.6in}p{.6in}p{.6in}p{.6in}p{.6in}p{.6in}}
  \hline
 & Borough & Total & Murder & Rape & Felony & Larceny & Robbery & Vehicle & Burglary \\ 
  \hline
 & Bronx        & 727 & 8 & 18 & 191 & 165 & 331 & 3 & 11 \\ 
& Brooklyn      & 946 & 4 & 21 & 179 & 411 & 317 & 1 & 13 \\ 
& BQ & 33 & 1 & 0 & 6 & 9 & 15 & 2 & 0\\ 
& Manhattan    & 1002 & 1 & 15 & 140 & 576 & 247 & 3 & 20 \\ 
& Queens        & 660 & 6 & 12 & 117 & 267 & 232 & 9 & 17 \\ 
& SI & 40 & 0 & 1 & 5 & 7 & 24 & 0 & 3 \\ 
   \hline
\end{tabular}
\end{table}

#Grouped Barchart 

```{r}
#from wide to long--easier to make ggplot 
TotBoroughLong <- gather(TotCrimesBorough, Crime_Type, Amount, GrandTotal:BurglaryTotal)
#Grouped 
ggplot(TotBoroughLong, aes(fill=BOROUGH, y=Amount, x = Crime_Type))+
  geom_bar(position = "dodge", stat = "identity")+
  geom_text(aes(label = Amount), position = position_dodge(.9), vjust = 0)+
  ggtitle("Total Crimes by Borough and Crime Type in NYC Parks") + 
  labs(y = "Number of Crimes", x = "Crime Type")
```

#Grouped Barchart without Total 

```{r}
#subsetting out GrandTotal 
TotBoroughLongb <- TotBoroughLong[which(TotBoroughLong$Crime_Type != "GrandTotal"),]
#Grouped
ggplot(TotBoroughLongb, aes(fill=BOROUGH, y=Amount, x = Crime_Type))+
  geom_bar(position = "dodge", stat = "identity")+
  geom_text(aes(label = Amount), position = position_dodge(.9), vjust = 0)+
  ggtitle("Total Crimes by Borough and Crime Type in NYC Parks") + 
  labs(y = "Number of Crimes", x = "Crime Type")
```
